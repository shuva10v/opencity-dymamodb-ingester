<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<title>OpenCity</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
<body>
	<div class="container">
		<div class="alert alert-warning alert-dismissible fade show" style="display:none;" role="alert" id="alert-box">
			<b id="error-text"></b>
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<h1>Check building</h1>
		<label for="lat">Latitude</label>
		<div class="input-group mb-3">
			<input type="text" class="form-control" id="lat">
		</div>
		<label for="lon">Longitude</label>
		<div class="input-group mb-3">
			<input type="text" class="form-control" id="lon">
		</div>
		<button type="button" class="btn btn-info" id="request-buildings">Request</button>
		<table class="table">
			<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">UBID</th>
				<th scope="col">Distance</th>
				<th scope="col">Height</th>
			</tr>
			</thead>
			<tbody id="results">
			</tbody>
		</table>
	</div>
<script>
	var apiUrl = "https://vsvtrqe825.execute-api.eu-west-1.amazonaws.com/opencity/api/";

	$(document).ajaxError(
		function (event, jqXHR, ajaxSettings, thrownError) {
			// var err = '[event:' + JSON.stringify(event) + '], [jqXHR:' + JSON.stringify(jqXHR) +
			// 	'], [ajaxSettings:' + JSON.stringify(ajaxSettings) + '], [thrownError:' + thrownError + '])';
			var err = "Error during request handling";
			$("#error-text").text(err);
			$("#alert-box").show();
			$("#alert-box").alert();
		});

	function on_error(xhr, status, error) {
		console.log("Error: " + xhr);
		console.log("Error: " + status);
		console.log("Error: " + error);
		var err = eval("(" + xhr.responseText + ")");

	}

	function render_buildings(data) {
		console.log(data);
	}
	
	function request_buildings(e) {
		e.preventDefault();
		var request = {"lat": $("#lat").val(), "lon": $("#lon").val()}
		$.ajax({
			url: apiUrl + "/buildings/get",
			type: "POST",
			data: JSON.stringify(request),
			success: render_buildings
		});
	}
	$(function () {
		$("#request-buildings").on('click', request_buildings)
	})
</script>
</body>
</html>